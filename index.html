<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Base -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tiny Pint — Big Beer, Small Space</title>
  <meta name="description" content="A 10-seat taproom serving 10–12 oz pours. Scarcity, community, and great beer." />
  <link rel="canonical" href="https://tinypint.beer/" />

  <!-- Icons -->
  <link rel="icon" type="image/png" href="/favicon.png" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  <!-- Colors -->
  <meta name="theme-color" content="#FAF9F6" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#111827" media="(prefers-color-scheme: dark)">
  <meta name="color-scheme" content="light">
  <meta name="robots" content="index,follow">

  <!-- Styles (Tailwind build) -->
  <link rel="stylesheet" href="output.css" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@600;700;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />

  <!-- Social -->
  <meta property="og:title" content="Tiny Pint — Big Beer, Small Space" />
  <meta property="og:description" content="10–12 oz pours, fresh rotation, cozy vibe. Limited seats. Join the Founding Fifty." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/og-image.jpg" />
  <meta property="og:url" content="https://tinypint.beer/" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- JSON-LD: Local Business (BarOrPub) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BarOrPub",
    "name": "Tiny Pint",
    "url": "https://tinypint.beer/",
    "logo": "https://tinypint.beer/logo.png",
    "address": { "@type": "PostalAddress", "addressLocality": "Spokane", "addressRegion": "WA", "addressCountry": "US" },
    "servesCuisine": "Beer",
    "slogan": "Big Beer, Small Space",
    "priceRange": "$$"
  }
  </script>

  <!-- Minimal inline utilities -->
  <style>
    .status-dot{display:inline-block;width:.6rem;height:.6rem;border-radius:9999px}
    .status-fresh{background:#10B981}.status-low{background:#F59E0B}.status-last{background:#EF4444}
    .strike{text-decoration:line-through;opacity:.7}
    .passport-stamp{display:inline-grid;place-items:center;width:3rem;height:3rem;border:2px dashed #E7E2DA;border-radius:.5rem}
    .stamp-earned{background:linear-gradient(135deg,#B07A2A22,#2E4D3A22)}
    .progress-outer{height:.5rem;border-radius:.5rem;border:1px solid #E7E2DA;overflow:hidden}
    .progress-inner{height:100%;width:0;background:linear-gradient(90deg,#B07A2A,#2E4D3A)}
    .pill{border:1px solid #E7E2DA;border-radius:9999px;padding:.25rem .5rem;font-size:.75rem}
    .ticker{height:.5rem;border:1px solid #E7E2DA;border-radius:9999px;overflow:hidden}
    .ticker > span{display:block;height:100%;width:0;background:linear-gradient(90deg,#2E4D3A,#B07A2A)}
    .plaque{border:1px solid #E7E2DA;border-radius:.5rem;padding:.5rem .6rem;background:#FAF9F6}
  </style>

  <!-- Supabase client (keys come from /.netlify/functions/config at runtime) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
</head>

<body class="bg-pint-paper text-pint-ink font-sans">
  <a class="sr-only focus:not-sr-only focus:fixed focus:top-2 focus:left-2 focus:bg-white focus:px-3 focus:py-2 focus:rounded-lg" href="#main">Skip to content</a>

  <!-- Header -->
  <header class="navbar sticky top-0 z-50" role="banner">
    <div class="max-w-6xl mx-auto p-3 md:p-4">
      <div class="flex items-center justify-between gap-3">
        <a href="#" class="text-xl md:text-2xl font-extrabold" aria-label="Tiny Pint home">Tiny Pint</a>

        <!-- Hamburger -->
        <button id="menuBtn" class="rounded-lg px-3 py-2 border border-pint-stone md:hidden" aria-expanded="false" aria-controls="primaryNav" aria-label="Toggle menu">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 6h16M4 12h16M4 18h16" stroke="#1F2937" stroke-width="2" stroke-linecap="round"/></svg>
        </button>

        <!-- Desktop Nav -->
        <nav class="hidden md:block" aria-label="Primary">
          <ul class="flex items-center gap-5">
            <li><a class="navlink" href="#taps">What’s Pouring</a></li>
            <li><a class="navlink" href="#about">About</a></li>
            <li><a class="navlink" href="#menu">Menu</a></li>
            <li><a class="navlink" href="#club">Pint Club</a></li>
            <li><a class="navlink" href="#passport">Beer Passport</a></li>
            <li><a class="navlink" href="#merch">Merch</a></li>
            <li><a class="navlink" href="#plans">Plans</a></li>
            <li><a class="navlink" href="#news">News</a></li>
            <li><a class="navlink" href="#location">Location</a></li>
          </ul>
        </nav>
      </div>

      <!-- Mobile Drawer -->
      <nav id="primaryNav" class="hidden md:hidden mt-3" aria-label="Mobile">
        <ul class="flex flex-col gap-2">
          <li><a class="navlink block px-2 py-2" href="#taps">What’s Pouring</a></li>
          <li><a class="navlink block px-2 py-2" href="#about">About</a></li>
          <li><a class="navlink block px-2 py-2" href="#menu">Menu</a></li>
          <li><a class="navlink block px-2 py-2" href="#club">Pint Club</a></li>
          <li><a class="navlink block px-2 py-2" href="#passport">Beer Passport</a></li>
          <li><a class="navlink block px-2 py-2" href="#merch">Merch</a></li>
          <li><a class="navlink block px-2 py-2" href="#plans">Plans & Press</a></li>
          <li><a class="navlink block px-2 py-2" href="#news">News</a></li>
          <li><a class="navlink block px-2 py-2" href="#location">Location</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="main">
    <!-- Hero -->
    <section class="text-center py-12 md:py-20 px-4">
      <p class="text-xs uppercase tracking-wide text-gray-600">Owner-operated taproom</p>
      <h1 class="text-4xl md:text-6xl font-extrabold mb-3 md:mb-4">Spokane’s Smallest Pub</h1>
      <p class="max-w-xl mx-auto text-base md:text-lg text-gray-600 mb-3">
        Just the good stuff: a 10-seat room pouring 10–12 oz beers that stay cold, taste right, and turn over fast.
      </p>
      <p id="live-views" class="text-xs text-gray-500 mb-6" aria-live="polite"></p>
      <div class="flex justify-center gap-3 md:gap-4">
        <a href="#taps" class="btn btn-primary">What’s Pouring</a>
        <a href="#club" class="btn btn-outline">Join the Founding Fifty</a>
      </div>
    </section>

    <!-- WHAT’S POURING -->
    <section id="taps" class="section py-14 md:py-20 bg-white">
      <div class="max-w-6xl mx-auto px-4 md:px-6">
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-3">
          <div>
            <h2 class="text-2xl md:text-3xl font-extrabold">What’s Pouring</h2>
            <p class="text-xs mt-1"><span class="pill">10 seats</span> <span class="pill">~198 pours/keg</span> <span class="pill">3 taps</span></p>
          </div>
          <p id="taps-updated" class="text-sm text-gray-600" aria-live="polite">Loading…</p>
        </div>

        <div class="grid gap-6 md:grid-cols-[1fr_380px] mt-6">
          <!-- Tap list -->
          <div aria-busy="true">
            <div id="taps-list" class="tap-grid"></div>

            <div id="taps-empty" class="hidden mt-6 text-sm text-gray-600">
              Tap list coming soon. We rotate often—check back!
            </div>

            <p class="mt-6 text-xs md:text-sm text-gray-600">
              Why tiny pours? A ½ bbl keg (~1,984 oz) yields ~198 Tiny Pints (10 oz) vs ~124 full pints (16 oz).
              That’s more variety for you, fresher beer for everyone.
            </p>
          </div>

          <!-- Visual panel / Scarcity + subscribe -->
          <aside class="card md:sticky md:top-20" aria-label="On tap visuals">
            <img src="/images/tap-handle.jpg" width="760" height="420" loading="lazy" decoding="async" alt="Tiny Pint tap handle" class="rounded-xl w-full h-56 object-cover">
            <div id="ontap-now" class="mt-3">
              <div class="text-sm text-gray-600">On tap now</div>
            </div>

            <div id="recently-tapped" class="mt-6" aria-live="polite"></div>

            <form name="beer-alerts" method="POST" data-netlify="true" netlify-honeypot="bot-field" class="mt-6 grid gap-2">
              <input type="hidden" name="form-name" value="beer-alerts">
              <p class="hidden"><label>Don’t fill this out: <input name="bot-field" /></label></p>
              <label class="text-sm text-gray-600">Get alerts when your favorite brewery hits the tap:</label>
              <input class="input" type="text" name="brewery" placeholder="Brewery (e.g., Wander, pFriem)" aria-label="Brewery name">
              <input class="input" type="email" name="email" placeholder="you@beerfan.com" autocomplete="email" required aria-label="Email for beer alerts">
              <button class="btn btn-outline" type="submit">Notify Me</button>
              <p class="text-xs text-gray-500">Segmented list: you’ll only hear about what you choose.</p>
            </form>
          </aside>
        </div>
      </div>
    </section>

    <!-- TINY MATH -->
    <section id="math" class="section py-14 md:py-20">
      <div class="max-w-5xl mx-auto px-4 md:px-6">
        <h2 class="text-2xl md:text-3xl font-extrabold">Tiny Math</h2>
        <p class="text-base md:text-lg text-gray-600 mt-2">
          Same keg, more happy glasses. Tiny Pints keep beer colder, rotate faster, and reduce waste.
        </p>

        <!-- KPI Cards -->
        <div class="grid gap-3 md:gap-4 md:grid-cols-3 mt-6">
          <div class="card" aria-live="polite">
            <div class="text-3xl font-extrabold"><span id="kegOz">1,984</span><span class="text-base font-bold"> oz</span></div>
            <div class="text-gray-600 mt-1">½-barrel keg (15.5 gal)</div>
          </div>
          <div class="card" aria-live="polite">
            <div class="text-3xl font-extrabold"><span id="tinyCount">198</span></div>
            <div class="text-gray-600 mt-1">Tiny Pints (10–12 oz)</div>
          </div>
          <div class="card" aria-live="polite">
            <div class="text-3xl font-extrabold"><span id="fullCount">124</span></div>
            <div class="text-gray-600 mt-1">Full Pints (16 oz)</div>
          </div>
        </div>

        <!-- Visual compare -->
        <div class="card mt-4" aria-labelledby="vizTitle">
          <div id="vizTitle" class="text-xl font-bold">More pours per keg</div>
          <p class="text-sm text-gray-600 mt-1">Illustrative comparison using current pour sizes.</p>

          <div class="mt-4 space-y-3">
            <div class="text-sm flex items-center justify-between">
              <span class="font-semibold">Tiny Pint</span>
              <span id="tinyCountLabel" class="text-gray-600">198 pours</span>
            </div>
            <div class="ticker" role="img" aria-label="Tiny Pint relative bar">
              <span id="tinyBar"></span>
            </div>

            <div class="text-sm flex items-center justify-between mt-4">
              <span class="font-semibold">Full Pint</span>
              <span id="fullCountLabel" class="text-gray-600">124 pours</span>
            </div>
            <div class="ticker" role="img" aria-label="Full Pint relative bar">
              <span id="fullBar"></span>
            </div>
          </div>

          <!-- Tiny revenue math -->
          <div class="grid gap-3 md:grid-cols-3 mt-6 text-sm">
            <div class="rounded-xl border border-pint-stone p-4">
              <div class="font-semibold">Assumptions</div>
              <ul class="mt-2 text-gray-600 list-stone">
                <li>Keg: <span id="assumeKeg">½-bbl (1,984 oz)</span></li>
                <li>Tiny pour: <span id="assumeTiny">10 oz @ $5</span></li>
                <li>Full pour: <span id="assumeFull">16 oz @ $6.50</span></li>
              </ul>
            </div>
            <div class="rounded-xl border border-pint-stone p-4">
              <div class="font-semibold">Gross per keg</div>
              <p class="mt-2"><span class="font-bold">Tiny:</span> <span id="tinyGross">$990</span></p>
              <p class="mt-1"><span class="font-bold">Full:</span> <span id="fullGross">$806</span></p>
            </div>
            <div class="rounded-xl border border-pint-stone p-4">
              <div class="font-semibold">Why it matters</div>
              <ul class="list-stone mt-2">
                <li>~<span id="morePct">60%</span> more pours</li>
                <li>Fresher kegs, faster rotation</li>
                <li>Guests can try more styles</li>
              </ul>
            </div>
          </div>

          <p class="text-xs text-gray-600 mt-4">Notes: Gross ≠ profit. COGS, tax, and tips not included.</p>
        </div>
      </div>
    </section>

    <!-- About -->
    <section id="about" class="section max-w-4xl mx-auto py-14 md:py-20 px-4 md:px-6">
      <h2 class="text-2xl md:text-3xl font-extrabold mb-4">About</h2>
      <p class="text-base md:text-lg mb-6">
        Tiny Pint is built by two Spokane bartenders who’ve spent years learning what sells, what doesn’t,
        and where the profit really is. A small, personal taproom that runs lean, stays flexible,
        and always feels good to be in.
      </p>
      <ul class="grid gap-3 md:gap-4 md:grid-cols-3">
        <li class="card"><strong>Big Beer, Small Space</strong><br /><span class="text-gray-600">10 seats, 3 taps, zero chaos.</span></li>
        <li class="card"><strong>Smart Margins</strong><br /><span class="text-gray-600">More pours per keg, fresher rotation.</span></li>
        <li class="card"><strong>Local Focus</strong><br /><span class="text-gray-600">Regional craft without full-bar overhead.</span></li>
      </ul>
    </section>

    <!-- Menu -->
    <section id="menu" class="section py-14 md:py-20 bg-white">
      <div class="max-w-5xl mx-auto px-4 md:px-6 text-center">
        <h2 class="text-2xl md:text-3xl font-extrabold mb-4">Menu</h2>
        <p class="max-w-xl mx-auto mb-8 text-gray-600">
          Big flavor. Small pours. Rotating taps + cans to-go. Our Tiny Pint (10–12 oz) keeps beer colder and reduces waste.
        </p>
        <div class="grid gap-4 md:gap-6 md:grid-cols-3">
          <div class="card">
            <h3 class="text-lg md:text-xl font-bold mb-1">Tiny Pint</h3>
            <p id="price-tiny" class="text-2xl md:text-3xl font-extrabold mb-1">$4–5</p>
            <p class="text-gray-600">10–12 oz. Perfect to the last sip.</p>
          </div>
          <div class="card">
            <h3 class="text-lg md:text-xl font-bold mb-1">Full Pint</h3>
            <p id="price-full" class="text-2xl md:text-3xl font-extrabold mb-1">$6–6.5</p>
            <p class="text-gray-600">16 oz. For the thirsty.</p>
          </div>
          <div class="card">
            <h3 class="text-lg md:text-xl font-bold mb-1">Tiny Flight</h3>
            <p class="text-2xl md:text-3xl font-extrabold mb-1">$12</p>
            <p class="text-gray-600">Three 5 oz pours. Try more, waste less.</p>
          </div>
        </div>
        <p id="pricing-banner" class="text-xs text-gray-500 mt-3" aria-live="polite"></p>
      </div>
    </section>

    <!-- Pint Club -->
    <section id="club" class="section py-14 md:py-20">
      <div class="max-w-5xl mx-auto px-4 md:px-6 grid gap-6 md:grid-cols-[1fr_360px] items-center">
        <div class="text-center md:text-left">
          <h2 class="text-2xl md:text-3xl font-extrabold mb-2">Founding Fifty — Pint Club</h2>
          <p class="text-base md:text-lg text-gray-600">$60/year gets you a $5 first Tiny Pint per visit, quarterly member nights, and 10% off merch.</p>
          <p class="text-sm text-gray-500 mt-3 max-w-lg md:max-w-none mx-auto md:mx-0">The Pint Club isn’t just a loyalty program; it’s how we stay small, nimble, and independent. Your support keeps the taps fresh without compromising the vision.</p>

          <div class="mt-6 flex flex-wrap gap-2 justify-center md:justify-start" role="group" aria-label="Choose a waitlist type">
            <button class="pill" data-waitlist="founding">Founding Fifty</button>
            <button class="pill" data-waitlist="beer-drop">Beer Drop Alerts</button>
            <button class="pill" data-waitlist="industry">Industry Night</button>
            <button class="pill" data-waitlist="rare-release">Rare Release Reserve</button>
          </div>

          <form name="tiny-waitlist" method="POST" data-netlify="true" netlify-honeypot="bot-field" class="max-w-md mx-auto md:mx-0 mt-4 flex flex-col sm:flex-row gap-3 justify-center md:justify-start">
            <input type="hidden" name="form-name" value="tiny-waitlist" />
            <input type="hidden" id="waitlist-type" name="type" value="founding" />
            <p class="hidden"><label>Don’t fill this out: <input name="bot-field" /></label></p>
            <input type="email" name="email" autocomplete="email" placeholder="you@beerfan.com" required class="input" aria-label="Email to join the selected waitlist" />
            <button class="btn btn-primary" type="submit">Join the List</button>
          </form>
          <p class="text-xs text-gray-500 mt-2">We’ll email when your selected list opens. No spam.</p>
        </div>

        <aside class="card">
          <img src="/images/founding-card.jpg" width="760" height="420" loading="lazy" decoding="async" alt="Founding Fifty membership card mockup" class="rounded-xl w-full h-48 object-cover">
          <p class="text-sm text-gray-600 mt-3">Members get a yearly card and exclusive nights. Limited to fifty.</p>
        </aside>
      </div>
    </section>

    <!-- Beer Passport -->
    <section id="passport" class="section py-14 md:py-20 bg-white">
      <div class="max-w-5xl mx-auto px-4 md:px-6">
        <div class="flex items-end justify-between gap-3">
          <h2 class="text-2xl md:text-3xl font-extrabold">Beer Passport</h2>
          <button id="btn-reset-passport" class="navlink underline text-sm">Reset (demo)</button>
        </div>
        <p class="text-gray-600 mt-2">Try new breweries, styles, and limited drops. Earn stamps and unlock perks.</p>

        <div class="grid md:grid-cols-3 gap-4 mt-6">
          <div class="card">
            <div class="font-semibold">Your progress</div>
            <div class="progress-outer mt-3"><div id="passport-progress" class="progress-inner"></div></div>
            <p id="passport-stats" class="text-sm text-gray-600 mt-2">0 stamps • 0 breweries • 0 styles</p>
          </div>

          <div class="card">
            <div class="font-semibold">Stamps</div>
            <div id="passport-stamps" class="mt-3 grid grid-cols-5 gap-2"></div>
          </div>

          <div class="card">
            <div class="font-semibold">Perks</div>
            <ul class="list-stone mt-2 text-sm">
              <li>Collect 5 stamps → <strong>10% off</strong> next visit</li>
              <li>Collect 10 stamps → <strong>Free Tiny Flight</strong></li>
              <li>First to try a new keg → your name on the chalkboard</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Merch -->
    <section id="merch" class="section py-14 md:py-20 text-center">
      <div class="max-w-3xl mx-auto px-4 md:px-6">
        <h2 class="text-2xl md:text-3xl font-extrabold mb-4">Merchandise</h2>
        <p class="text-base md:text-lg text-gray-600 mb-6">Support our small space with a big statement.</p>
        <div class="flex justify-center">
          <img src="/images/merch.jpg" alt="Tiny Pint branded hat and shirt" class="rounded-xl w-full max-w-md shadow">
        </div>
        <p class="text-sm text-gray-500 mt-4">Pre-orders open soon. Members get first dibs.</p>
      </div>
    </section>

    <!-- Plans & Press -->
    <section id="plans" class="section py-14 md:py-20">
      <div class="max-w-5xl mx-auto px-4 md:px-6">
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-3">
          <h2 class="text-2xl md:text-3xl font-extrabold">Plans &amp; Press</h2>
          <p class="text-sm text-gray-600 md:max-w-md">Want the numbers and the story? Grab our one-pager for a quick overview, or the full plan for the deep dive.</p>
        </div>

        <div class="grid gap-4 md:grid-cols-2 mt-6">
          <a class="card hover:text-pint-forest" href="/TinyPint_OnePager.pdf" target="_blank" rel="noopener">
            <div class="flex items-center justify-between">
              <h3 class="text-lg md:text-xl font-bold">Tiny Pint — One-Pager</h3>
              <span class="badge">PDF</span>
            </div>
            <p class="mt-2 text-gray-600">Concept, costs, and why Tiny Pints work — one page, quick read.</p>
          </a>

          <a class="card hover:text-pint-forest" href="/Tiny Pint Long.pdf" target="_blank" rel="noopener">
            <div class="flex items-center justify-between">
              <h3 class="text-lg md:text-xl font-bold">Tiny Pint — Full Plan</h3>
              <span class="badge">PDF</span>
            </div>
            <p class="mt-2 text-gray-600">Brand, operations, licensing, margins, launch timeline, and projections.</p>
          </a>
        </div>

        <p class="text-sm text-gray-600 mt-6">Media or landlords: email <a class="underline" href="mailto:hello@tinypint.beer">hello@tinypint.beer</a> for a press kit.</p>
      </div>
    </section>

    <!-- Location -->
    <section id="location" class="section py-14 md:py-20">
      <div class="max-w-4xl mx-auto px-4 md:px-6 text-center">
        <h2 class="text-2xl md:text-3xl font-extrabold mb-4">Location &amp; Hours</h2>
        <p>Opening soon in downtown Spokane, WA. We’re currently scouting a cozy space with patio potential to call home.</p>
        <p class="text-sm mt-4 text-gray-600">Planned Hours: Monday–Thursday (Day Mode), Thursday–Saturday (Industry Mode)</p>
        <p class="text-sm mt-1 text-gray-600">We’ll announce our official address and opening date when our tap system is installed and ready to pour.</p>
        <p class="text-sm mt-4 text-gray-600">Contact: <a class="underline" href="mailto:hello@tinypint.beer">hello@tinypint.beer</a></p>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="section py-8 md:py-10" role="contentinfo">
    <div class="max-w-5xl mx-auto px-4 md:px-6 trust-line">
      <p>Independent &amp; owner-operated • Beer-only tavern • 21+</p>
      <p class="mt-2">© <script>document.write(new Date().getFullYear())</script> Tiny Pint — Big Beer, Small Space.</p>
    </div>
  </footer>

  <!-- Sticky mobile bottom bar -->
  <nav class="sticky-cta md:hidden" aria-label="Quick navigation">
    <div class="max-w-6xl mx-auto px-4">
      <ul class="grid grid-cols-3 text-center">
        <li><a href="#taps" class="py-3 block">Menu</a></li>
        <li><a href="#club" class="py-3 block">Join</a></li>
        <li><a href="#location" class="py-3 block">Directions</a></li>
      </ul>
    </div>
  </nav>

  <!-- ---------- APP JS ---------- -->
  <script>
    // ------- Mobile menu -------
    const btn = document.getElementById('menuBtn');
    const nav = document.getElementById('primaryNav');
    if (btn && nav) {
      btn.addEventListener('click', () => {
        const willOpen = nav.classList.contains('hidden');
        nav.classList.toggle('hidden');
        btn.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
      });
    }

    // ------- Helpers -------
    const $ = (id) => document.getElementById(id);
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const asMoney = (n) => { const s = Number(n).toFixed(2); return `$${s.endsWith('.00') ? s.slice(0,-3) : s}`; };
    const fmtABV = (n) => typeof n === 'number' ? `${n.toFixed(1)}% ABV` : '';
    const fmtUpdated = (iso) => { try { return new Date(iso).toLocaleString([], { dateStyle: 'medium', timeStyle: 'short' }); } catch { return iso || ''; } };

    function toast(msg, ms=2400){
      const div = document.createElement('div');
      div.textContent = msg; div.setAttribute('role','status');
      Object.assign(div.style,{position:'fixed',left:'50%',bottom:'1.25rem',transform:'translateX(-50%)',padding:'.6rem .8rem',background:'#1F2937',color:'#fff',borderRadius:'.5rem',boxShadow:'0 10px 25px rgba(0,0,0,.15)',zIndex:9999});
      document.body.appendChild(div); setTimeout(()=>div.remove(),ms);
    }

    // ------- Supabase bootstrap via Netlify function -------
    async function initSupabaseFromConfig() {
      try {
        const res = await fetch('/.netlify/functions/config', { cache: 'no-store' });
        if (!res.ok) throw new Error('config http ' + res.status);
        const cfg = await res.json();
        const url = cfg?.supabase?.url;
        const anon = cfg?.supabase?.anon;
        if (!url || !anon) throw new Error('Missing url/anon in /config');
        window.sb = supabase.createClient(url, anon, { auth: { persistSession: false } });
        return true;
      } catch (e) {
        console.warn('Supabase config failed:', e);
        toast('Live data offline. Showing last known list.');
        return false;
      }
    }

    // ------- Live views (client-side demo) -------
    (function liveViews(){
      const k = 'tp_views', hr = 60*60*1000, now = Date.now();
      let arr = JSON.parse(localStorage.getItem(k) || '[]').filter(t => now - t < hr);
      arr.push(now);
      localStorage.setItem(k, JSON.stringify(arr));
      const el = $('live-views');
      if (el) el.textContent = `${arr.length} people checked this page in the last hour`;
    })();

    // ------- Scarcity engine -------
    function scarcityBadge(pours) {
      if (pours <= 12) return { text:`LAST CALL · ${pours} pours left`, cls:'status-last' };
      if (pours <= 40) return { text:`RUNNING LOW · ${pours} remaining`, cls:'status-low' };
      return { text:`FRESH · just tapped`, cls:'status-fresh' };
    }

    // ------- Dynamic pricing (client demo rules) -------
    const dynamicRules = { happyHour: { days:[1,2,3], start:'15:00', end:'17:00', tiny:3.50 }, lastCallOff: 1.00 };
    function withinWindow(start, end, d=new Date()){
      const [sh,sm] = start.split(':').map(Number), [eh,em] = end.split(':').map(Number);
      const t = d.getHours()*60 + d.getMinutes();
      return t >= (sh*60 + sm) && t <= (eh*60 + em);
    }
    function priceFor(tap, basePrice, now=new Date()){
      let label = null, price = basePrice;
      if (typeof tap.poursRemaining === 'number' && tap.poursRemaining <= 20) { price = Math.max(0, basePrice - dynamicRules.lastCallOff); label = `Last call pricing`; }
      const dow = now.getDay();
      if (dynamicRules.happyHour.days.includes(dow) && withinWindow(dynamicRules.happyHour.start, dynamicRules.happyHour.end, now)) {
        if (dynamicRules.happyHour.tiny < price) { price = dynamicRules.happyHour.tiny; label = `Happy Hour: ${dynamicRules.happyHour.start}–${dynamicRules.happyHour.end}`; }
      }
      return { price, label };
    }

    // ------- Supabase reads (snake_case -> UI map) -------
    async function fetchActiveTaps() {
      const { data, error } = await sb
        .from('taps')
        .select(`
          id,
          name,
          brewery,
          style,
          abv,
          is_on_tap,
          pours_remaining,
          keg_size_oz,
          tapped_at,
          updated_at
        `)
        .eq('is_on_tap', true)
        .order('brewery', { ascending: true });

      if (error) throw error;

      return (data || []).map(r => ({
        id: r.id,
        name: r.name,
        brewery: r.brewery,
        style: r.style,
        abv: Number(r.abv),
        sizes: { tiny: 10, full: 16 },
        price: { tiny: 5.0, full: 6.5 },
        poursRemaining: Number.isFinite(r.pours_remaining) ? r.pours_remaining : 0,
        kegSizeOz: Number.isFinite(r.keg_size_oz) ? r.keg_size_oz : 1984,
        tappedAt: r.tapped_at,
        status: r.is_on_tap ? 'on' : 'off'
      }));
    }

    async function fetchRecentlyKicked(hours=24) {
      const since = new Date(Date.now() - hours*3600*1000).toISOString();
      const { data, error } = await sb
        .from('taps')
        .select('id,name,brewery,updated_at')
        .eq('is_on_tap', false)
        .gte('updated_at', since)
        .order('updated_at', { ascending: false })
        .limit(8);

      if (error) throw error;

      return (data || []).map(r => ({
        id: r.id,
        name: r.name,
        brewery: r.brewery,
        updatedAt: r.updated_at
      }));
    }

    // ------- Renderers -------
    function renderOnTapNow(taps){
      const wrap = $('ontap-now');
      if (!wrap) return;
      wrap.innerHTML = '<div class="text-sm text-gray-600">On tap now</div>';
      taps.filter(t => (t.status||'on') === 'on').slice(0,3).forEach(t => {
        const s = scarcityBadge(t.poursRemaining ?? 999);
        const row = document.createElement('div');
        row.className = 'flex items-center gap-2 mt-2';
        row.innerHTML = `<span class="status-dot ${s.cls}" aria-hidden="true"></span><span class="text-sm">${t.name} <span class="text-gray-600">· ${t.style}</span></span>`;
        wrap.appendChild(row);
      });
    }

    function renderTaps(taps){
      const listEl = $('taps-list');
      const emptyEl = $('taps-empty');
      const updatedEl = $('taps-updated');

      listEl.parentElement?.setAttribute('aria-busy','false');
      if (!taps.length) {
        emptyEl.textContent = 'Taps rotate fast. Nothing listed right now — check back shortly.';
        emptyEl.classList.remove('hidden');
        updatedEl.textContent = '';
        listEl.innerHTML = '';
        return;
      }

      emptyEl.classList.add('hidden');
      updatedEl.textContent = `Live · ${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`;

      // Sort by scarcity (low first)
      taps.sort((a,b)=> (a.poursRemaining ?? 999) - (b.poursRemaining ?? 999));

      listEl.innerHTML = taps.map((t, idx) => {
        const on = (t.status || 'on') === 'on';
        const tinyBase = t?.price?.tiny, fullBase = t?.price?.full;
        const tinyDyn = typeof tinyBase === 'number' ? priceFor(t, tinyBase) : null;
        const fullDyn = typeof fullBase === 'number' ? priceFor(t, fullBase) : null;
        const scarcity = scarcityBadge(t.poursRemaining ?? 999);

        // Keg ticker width by ounces: poursRemaining * tiny size / keg size
        const assumedTinyOz = t?.sizes?.tiny ?? 10;
        const kegOz = t?.kegSizeOz ?? 1984; // ½ bbl default
        const filledOz = (t.poursRemaining ?? 0) * assumedTinyOz;
        const pct = Math.max(0, Math.min(100, Math.round((filledOz / kegOz) * 100)));

        return `
          <article class="card ${on ? '' : 'opacity-60'}">
            <div class="flex items-start justify-between gap-3">
              <div>
                <h3 class="text-lg md:text-xl font-bold ${on ? '' : 'line-through'}">${t.name || 'Beer'}</h3>
                <p class="text-sm text-gray-600">${[t.brewery, t.style].filter(Boolean).join(' · ')}</p>
              </div>
              ${on ? `<span class="pill"><span class="status-dot ${scarcity.cls}" aria-hidden="true"></span> ${scarcity.text}</span>` : '<span class="badge" aria-label="Eighty-sixed">86’d</span>'}
            </div>

            <!-- Keg Ticker -->
            <div class="mt-3">
              <div class="ticker" role="img" aria-label="Approximate keg level">
                <span style="width:${pct}%"></span>
              </div>
              <div class="text-xs text-gray-600 mt-1">${t.poursRemaining ?? '—'} pours remaining</div>
            </div>

            <!-- Pricing -->
            <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
              ${t?.sizes?.tiny ? `
                <div class="rounded-xl border border-pint-stone p-3">
                  <div class="flex items-center justify-between">
                    <span>10–12 oz</span>
                    <span class="tap-price">
                      ${tinyDyn && tinyDyn.price !== tinyBase ? `<span class="strike">${asMoney(tinyBase)}</span> ${asMoney(tinyDyn.price)}` : `${asMoney(tinyBase)}`}
                    </span>
                  </div>
                  <div class="tap-size">Tiny Pint ${tinyDyn?.label ? `<span class="text-gray-500">• ${tinyDyn.label}</span>`:''}</div>
                </div>` : '' }
              ${t?.sizes?.full ? `
                <div class="rounded-xl border border-pint-stone p-3">
                  <div class="flex items-center justify-between">
                    <span>16 oz</span>
                    <span class="tap-price">
                      ${fullDyn && fullDyn.price !== fullBase ? `<span class="strike">${asMoney(fullBase)}</span> ${asMoney(fullDyn.price)}` : `${asMoney(fullBase)}`}
                    </span>
                  </div>
                  <div class="tap-size">Full Pint ${fullDyn?.label ? `<span class="text-gray-500">• ${fullDyn.label}</span>`:''}</div>
                </div>` : '' }
            </div>

            <div class="mt-3 flex items-center justify-between">
              <div class="text-xs text-gray-600">${fmtABV(t.abv)}</div>
              <div class="flex gap-2">
                <button class="pill" data-stamp='${idx}'>I had this</button>
                <button class="pill" data-reserve='${idx}'>Reserve 1</button>
                <button class="pill" data-rate='${idx}' aria-label="Rate this beer">Rate ★</button>
              </div>
            </div>

            <!-- Adoption plaque (placeholder) -->
            <div class="mt-3 text-sm text-gray-700" data-plaque hidden></div>
          </article>
        `;
      }).join('');

      // Wire actions
      listEl.querySelectorAll('[data-stamp]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const tap = taps[Number(btn.dataset.stamp)];
          addStamp(tap);
        });
      });
      listEl.querySelectorAll('[data-reserve]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const tap = taps[Number(btn.dataset.reserve)];
          reservePour(tap);
        });
      });
      listEl.querySelectorAll('[data-rate]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const tap = taps[Number(btn.dataset.rate)];
          rateBeer(tap);
        });
      });

      renderOnTapNow(taps);

      // Demo: show one plaque nicely
      const firstPlaque = listEl.querySelector('[data-plaque]');
      if (firstPlaque) {
        firstPlaque.hidden = false;
        firstPlaque.className = 'plaque mt-3';
        firstPlaque.innerHTML = `
          <div class="text-[10px] uppercase tracking-wide text-gray-500">Adopted by</div>
          <div class="font-semibold">Drew K.</div>
          <div class="text-xs text-gray-600 mt-1">“A perfect beer for a perfect Spokane afternoon.”</div>
        `;
      }
    }

    async function renderRecentlyTapped() {
      const box = $('recently-tapped');
      if (!box) return;
      try {
        const list = await fetchRecentlyKicked(24);
        if (!list.length) { box.innerHTML = ''; return; }
        box.innerHTML = `
          <div class="text-sm text-gray-600 mb-2">Recently tapped</div>
          <div class="grid gap-2">
            ${list.map(k => `
              <div class="rounded-lg border border-pint-stone p-3 bg-white opacity-90">
                <div class="font-semibold">${k.brewery} — ${k.name}</div>
                <div class="text-xs text-gray-600">Kicked: ${new Date(k.updatedAt).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})} · 198 pours of glory</div>
              </div>`).join('')}
          </div>
        `;
      } catch (e) { console.error(e); }
    }

    // ------- Fallback loaders -------
    function getInlineTapsJSON() { try { const el = document.querySelector('#taps-data'); return el ? JSON.parse(el.textContent) : null; } catch { return null; } }
    async function fetchTapsJSON() { try { const res = await fetch('taps.json', { cache:'no-store' }); if (!res.ok) throw 0; return await res.json(); } catch { return null; } }
    async function loadFromFallback() {
      const updatedEl = $('taps-updated');
      const local = getInlineTapsJSON() || await fetchTapsJSON();
      if (!local) { renderTaps([]); return; }
      updatedEl.textContent = local?.lastUpdated ? `Last updated — ${fmtUpdated(local.lastUpdated)}` : '';
      renderTaps(local?.taps || []);
    }

    // ------- Realtime -------
    function bootRealtime() {
      sb.channel('realtime:taps')
        .on('postgres_changes', { event: '*', schema: 'public', table: 'taps' }, async () => {
          try { const taps = await fetchActiveTaps(); renderTaps(taps); renderRecentlyTapped(); } catch(e){ console.error(e); }
        })
        .subscribe();
    }

    // ------- Passport (demo; local storage) -------
    const PASS_KEY = 'tp_passport';
    const loadPassport = () => JSON.parse(localStorage.getItem(PASS_KEY) || '{"stamps":[],"breweries":{},"styles":{}}');
    const savePassport = (p) => localStorage.setItem(PASS_KEY, JSON.stringify(p));
    function addStamp(tap){
      const p = loadPassport();
      const id = `${tap.brewery} • ${tap.name}`;
      if (!p.stamps.includes(id)) p.stamps.push(id);
      p.breweries[tap.brewery] = (p.breweries[tap.brewery]||0) + 1;
      p.styles[tap.style] = (p.styles[tap.style]||0) + 1;
      savePassport(p); renderPassport(); toast(`Stamped: ${tap.name}`); maybeNotifyPerks();
    }
    function renderPassport(){
      const p = loadPassport();
      const total = Math.min(p.stamps.length, 20), pct = (total/20)*100;
      const prog = $('passport-progress'); if (prog) prog.style.width = `${pct}%`;
      const stats = $('passport-stats'); if (stats) stats.textContent = `${p.stamps.length} stamps • ${Object.keys(p.breweries).length} breweries • ${Object.keys(p.styles).length} styles`;
      const box = $('passport-stamps'); if (!box) return;
      box.innerHTML = '';
      for(let i=0;i<20;i++){
        const d = document.createElement('div');
        d.className = 'passport-stamp' + (i<total ? ' stamp-earned' : '');
        d.textContent = i<total ? '✓' : '';
        box.appendChild(d);
      }
    }
    function maybeNotifyPerks(){ const p = loadPassport(); if (p.stamps.length === 5) toast('Perk unlocked: 10% off next visit'); if (p.stamps.length === 10) toast('Perk unlocked: Free Tiny Flight'); }

    // ------- Reserve & Rate (demo UX only) -------
    function reservePour(tap){
      const key = 'tp_reservations';
      const all = JSON.parse(localStorage.getItem(key)||'[]');
      all.push({ at:Date.now(), tap:`${tap.brewery} • ${tap.name}` });
      localStorage.setItem(key, JSON.stringify(all));
      toast(`Reserved 1: ${tap.name}. Show this at the bar.`);
      maybeNotify(`Reservation confirmed for ${tap.name}`, { body: 'Show this message at Tiny Pint.' });
    }
    function rateBeer(tap){
      const s = prompt(`Rate ${tap.name} (1–5 stars):`, '5'); const n = Number(s);
      if (!n || n<1 || n>5) return;
      const key = 'tp_ratings', all = JSON.parse(localStorage.getItem(key)||'{}');
      const id = `${tap.brewery} • ${tap.name}`, prev = all[id] || { total:0, count:0 };
      prev.total += n; prev.count += 1; all[id] = prev;
      localStorage.setItem(key, JSON.stringify(all));
      toast(`Thanks! Current avg: ${(prev.total/prev.count).toFixed(1)}★ (${prev.count})`);
    }

    async function maybeNotify(title, options){
      try {
        if (!('Notification' in window)) return;
        if (Notification.permission === 'granted') new Notification(title, options);
        else if (Notification.permission !== 'denied') {
          const p = await Notification.requestPermission();
          if (p === 'granted') new Notification(title, options);
        }
      } catch {}
    }

    // ------- Pricing banner -------
    function updatePricingBanner(){
      const now = new Date(), dow = now.getDay();
      const isHH = dynamicRules.happyHour.days.includes(dow) && withinWindow(dynamicRules.happyHour.start,dynamicRules.happyHour.end,now);
      const el = $('pricing-banner'); if (!el) return;
      el.textContent = isHH ? `Happy Hour: ${dynamicRules.happyHour.start}–${dynamicRules.happyHour.end} (Mon–Wed). Tiny Pints ${asMoney(dynamicRules.happyHour.tiny)}.` : '';
    }

    // ------- Section highlight (a11y polish) -------
    (function sectionHighlight(){
      const links = [...document.querySelectorAll('a.navlink[href^="#"]')];
      const sections = links.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if (e.isIntersecting) {
            const id = `#${e.target.id}`;
            links.forEach(l => l.setAttribute('aria-current', l.getAttribute('href')===id ? 'page' : 'false'));
          }
        });
      },{ rootMargin: '0px 0px -60% 0px', threshold: 0.1 });
      sections.forEach(s => io.observe(s));
    })();

    // ------- Tiny Math -------
    function runTinyMath() {
      const KEG_OZ = 15.5 * 128, TINY_OZ = 10, FULL_OZ = 16, TINY_PRICE = 5.00, FULL_PRICE = 6.50;
      const kegOz = Math.round(KEG_OZ);
      const tinyCount = Math.floor(kegOz / TINY_OZ), fullCount = Math.floor(kegOz / FULL_OZ);
      const tinyGross = tinyCount * TINY_PRICE, fullGross = fullCount * FULL_PRICE;
      const morePct = Math.round(((tinyCount / fullCount) - 1) * 100);
      $('kegOz').textContent = kegOz.toLocaleString();
      $('tinyCount').textContent = tinyCount.toLocaleString();
      $('fullCount').textContent = fullCount.toLocaleString();
      $('tinyCountLabel').textContent = `${tinyCount.toLocaleString()} pours`;
      $('fullCountLabel').textContent = `${fullCount.toLocaleString()} pours`;
      $('assumeKeg').textContent = '½-bbl (' + kegOz.toLocaleString() + ' oz)';
      $('assumeTiny').textContent = `${TINY_OZ} oz @ $${TINY_PRICE.toFixed(2).replace(/\.00$/,'')}`;
      $('assumeFull').textContent = `${FULL_OZ} oz @ $${FULL_PRICE.toFixed(2).replace(/\.00$/,'')}`;
      $('tinyGross').textContent = `$${Math.round(tinyGross).toLocaleString()}`;
      $('fullGross').textContent = `$${Math.round(fullGross).toLocaleString()}`;
      $('morePct').textContent = isFinite(morePct) ? morePct : '—';

      const maxCount = Math.max(tinyCount, fullCount);
      const tinyW = Math.max(6, Math.round((tinyCount / maxCount) * 100));
      const fullW = Math.max(6, Math.round((fullCount / maxCount) * 100));
      const tinyBar = $('tinyBar'), fullBar = $('fullBar');
      if (prefersReduced) { tinyBar.style.width = tinyW + '%'; fullBar.style.width = fullW + '%'; }
      else {
        [tinyBar, fullBar].forEach((bar, i) => {
          const target = i === 0 ? tinyW : fullW;
          bar.style.transition = 'width 600ms cubic-bezier(.2,.9,.2,1)';
          requestAnimationFrame(() => { bar.style.width = target + '%'; });
        });
      }
    }

    // ------- Passport init -------
    function bootPassportUI(){
      renderPassport();
      const reset = $('btn-reset-passport');
      if (reset) reset.addEventListener('click', ()=>{ localStorage.removeItem(PASS_KEY); renderPassport(); toast('Passport reset (demo).'); });
    }

    // ------- Boot -------
    document.addEventListener('DOMContentLoaded', async () => {
      runTinyMath();
      bootPassportUI();

      const listWrap = $('taps-list').parentElement;
      listWrap?.setAttribute('aria-busy','true');

      const ok = await initSupabaseFromConfig();

      try {
        if (!ok) throw new Error('supabase bootstrap failed');
        const taps = await fetchActiveTaps();
        renderTaps(taps);
        renderRecentlyTapped();
        bootRealtime();
      } catch (e) {
        console.warn('Supabase fetch failed, falling back to local JSON', e);
        await loadFromFallback();
      }

      updatePricingBanner();
    });
  </script>

  <!-- Fallback inline taps (optional dev aid) -->
  <script id="taps-data" type="application/json">
  {"lastUpdated":"","taps":[]}
  </script>

  <noscript>
    <style>#taps-list::after{content:"Enable JavaScript to see live tap updates.";display:block;color:#6B7280;margin-top:.5rem;font-size:.875rem}</style>
  </noscript>
</body>
</html>
